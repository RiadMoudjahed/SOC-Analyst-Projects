# SQL Injection Prevention Demo
_A compact educational lab that demonstrates how SQL injection (SQLi) works and how to prevent it using parameterized queries, bcrypt authentication, and audit logging._

---

## Table of contents
- [What is SQL injection?](#what-is-sql-injection)
- [Lab objectives](#lab-objectives)
- [Environment & prerequisites](#environment--prerequisites)
- [Step 1 — Create schema and sample data](#step-1---create-schema-and-sample-data)
- [Step 2 — Vulnerable demo (local only)](#step-2---vulnerable-demo-local-only)
- [Step 3 — Secure implementation](#step-3---secure-implementation)
- [Step 4 — Audit logging and RBAC demo](#step-4---audit-logging-and-rbac-demo)
- [Evidence to collect (for portfolio)](#evidence-to-collect-for-portfolio)
- [Security & safety notes](#security--safety-notes)
- [What I learned](#what-i-learned-example-reflection)
- [Attribution](#attribution)

---

## What is SQL injection?
See the excellent PortSwigger writeup: [What is SQL injection?](https://portswigger.net/web-security/sql-injection)

> SQL injection (SQLi) is a web security vulnerability that allows an attacker to interfere with the queries that an application makes to its database. This can expose or modify data the application can access.

<img width="600" height="460" alt="image" src="https://github.com/user-attachments/assets/d7b7d86b-d716-4c75-bf66-9a07f4787e05" />

---

## Lab objectives
- Demonstrate a **vulnerable** login implementation (local-only demonstration).  
- Show how **SQLi** can bypass naive authentication.  
- Implement a **secure** login using parameterized queries and bcrypt.  
- Add simple **audit logging** for failed/successful login attempts.  
- Produce reproducible artifacts for a portfolio: `SQLi-Test.sql`, screenshots, and a short write-up.

---

## Environment & prerequisites
- Python 3.8+  
- SQLite (built-in with Python) or DB Browser for SQLite (optional GUI)

---

## Step 1 — Create schema and sample data

### 1. Create the users Table:

```sql
CREATE TABLE users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT NOT NULL UNIQUE,
  password_hash TEXT NOT NULL,
  role TEXT
);

INSERT INTO users (username, password_hash, role) VALUES
('alice', '$2y$10$8E0Kq1clJM64N2w1H2i9d.6srB0pK0cFludEXVaZLDiL5ZuDrIVFi', 'admin'),
('crane', '$2y$14$LyAgPLXany8Z0nf7V3PsIeG.MOVW5CqJ2Lb1NCOKZh/Q.FVc0bOpa', 'manager'),
('bob',   '$2y$10$GClhnEim64YM8bjLIdSMJ.SxzKBiEzMbTXKWyNfM4duB2.CBAHHEO', 'user');
```

### 2. Create the transactions table:

```sql
CREATE TABLE transactions (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER NOT NULL,
  amount REAL NOT NULL,
  created_at TEXT DEFAULT CURRENT_TIMESTAMP,
  description TEXT,
  FOREIGN KEY(user_id) REFERENCES users(id)
);

INSERT OR IGNORE INTO transactions ( user_id, amount, description) VALUES
(1, 1200.50, 'Salary Deposit'),
(3, -45.99, 'Online Purchase');
```

### 3. Create the audit logs table:

```sql
CREATE TABLE audit_logs (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  user_id INTEGER,
  action TEXT,
  detail TEXT,
  ip_address TEXT,
  create_at TEXT DEFAULT CURRENT_TIMESTAMP
);
```

<p align="center">
  <img width="480" alt="Create users table" src="https://github.com/user-attachments/assets/ff709c1f-31dc-4ab4-9cac-0e461ecd2534" />
</p>
<p align="center">
  <img width="320" alt="Create transactions table" src="https://github.com/user-attachments/assets/f306561b-1f5a-4980-af13-1441c00a01e4" />
  <img width="320" alt="Create audit logs table" src="https://github.com/user-attachments/assets/b2ecad9a-dbfa-4cfa-b753-7486acf859f5" />
</p>

<p align="center"><em>Figure 1 — Users table (top) and related transaction/audit tables (bottom).</em></p>

---

## Step 2 — Vulnerable demo (local only)

```python
import sqlite3    # Import sqlite3 library

conn = sqlite3.connect('SQLi-Test.db')    # Connect to the database
cur = conn.cursor()    # Open connection

username = input("username> ")    # Ask the user to enter a username
password = input("password> ")    # Ask the user to enter a password

# Vulnerable: concatenation -> subject to injection if used in WHERE conditions
query = f"SELECT id, username, password_hash, role FROM users WHERE username = '{username}';"
print("Executing query:", query)
cur.execute(query)
row = cur.fetchone()
print("DB returned:", row)

conn.close()    # Close connection
```
### Test the code using the following payload:
```
' OR '1'='1
```

<img width="934" height="824" alt="4  write python code for vulnerability test and RUN" src="https://github.com/user-attachments/assets/16311018-f9a1-476b-9d7c-d93b5c8c02d0" />

---

## Step 3 — Secure implementation

### Before we get started, [What is 'bcrypt'?](https://nordvpn.com/blog/what-is-bcrypt/)

Bcrypt is a lauded **password-storing** solution that uses **complicated cryptographic algorithms**, significantly reducing the chances of a hacker cracking your password. 
